{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Tourist Safety System</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Georgia&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Fallback */
            position: relative;
            display: flex;
            flex-direction: column; /* Allow stacking of main and footer */
            justify-content: center;
            min-height: 100vh;
            padding-top: 80px; /* Space for fixed navbar */
        }
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: url('https://res.cloudinary.com/dve59du8z/image/upload/v1757783292/GettyImages-522478216-5ab12c4e3de4230036949cee_qc7h4c.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            z-index: -1;
            filter: blur(4px);
            animation: fadeInBody 1s ease-in-out forwards;
        }

        @keyframes fadeInBody {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .navbar-glass {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .auth-card {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border-radius: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.18);
            border-top: 4px solid #f39c12;
            max-width: 480px;
            width: 100%;
            margin-top: 2rem;
            margin-bottom: 2rem;
            position: relative; /* Crucial for doodle positioning */
        }

        .btn-primary { background-color: #f39c12; border-color: #f39c12; }
        .btn-primary:hover { background-color: #e67e22; border-color: #e67e22; }
        .btn-danger { background-color: #e74c3c; border-color: #e74c3c; }
        .btn-danger:hover { background-color: #c0392b; border-color: #c0392b; }

        .btn-hover-effect {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .btn-hover-effect:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.2);
        }
        
        .brand-font {
            font-family: 'Georgia', serif;
            font-weight: bold;
            background: linear-gradient(90deg, #e67e22, #f39c12, #ffc107, #e67e22);
            background-size: 200% auto;
            color: #000;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: slide-gradient 5s linear infinite;
        }
        
        @keyframes slide-gradient { to { background-position: 200% center; } }

        .header-image-container { margin-top: -75px; position: relative; }
        .namaste-img {
            width: 150px; height: 150px; object-fit: cover;
            border-radius: 50%; border: 4px solid white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .welcome-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 1.75rem;
            font-weight: 600;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.8);
            pointer-events: none;
        }

        .form-control:focus { border-color: #f39c12; box-shadow: 0 0 0 0.25rem rgba(243, 156, 18, 0.25); }
        a { color: #e67e22; text-decoration: none; }
        a:hover { color: #f39c12; }

        .features-section {
            padding: 5rem 0;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
            background: rgba(0, 0, 0, 0.4); /* Dark overlay for contrast */
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .feature-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border-radius: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 12px 32px 0 rgba(31, 38, 135, 0.3);
        }
        .feature-icon { font-size: 3rem; color: #f39c12; }

        .site-footer {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            color: #f1f1f1;
            padding: 40px 0;
            margin-top: auto;
        }
        .site-footer h5 { color: #f39c12; }
        .site-footer a { color: #f1f1f1; }
        .site-footer a:hover { color: #f39c12; }
        .social-icons a {
            color: #f1f1f1;
            font-size: 1.5rem;
            margin: 0 10px;
            transition: color 0.3s ease;
        }
        .social-icons a:hover { color: #f39c12; }

        /* Doodle Animation Styles */
        .doodle {
            position: absolute;
            opacity: 0.8;
            width: 50px;
            height: 50px;
            animation: float 8s ease-in-out infinite;
            z-index: -1;
            color: #f39c12;
        }
        .doodle-1 { top: -25px; left: -25px; animation-duration: 9s; }
        .doodle-2 { top: -25px; right: -25px; animation-delay: 2.5s; }
        .doodle-3 { top: 50%; left: -60px; transform: translateY(-50%); animation-delay: 1.5s; animation-duration: 10s; }
        .doodle-4 { top: 50%; right: -60px; transform: translateY(-50%); animation-delay: 3.5s; }
        .doodle-5 { bottom: -25px; left: -25px; animation-delay: 0.5s; animation-duration: 11s; }
        .doodle-6 { bottom: -25px; right: -25px; animation-delay: 4.5s; animation-duration: 7s; }

        @keyframes float {
            0% { transform: translate(0, 0px) rotate(0deg); opacity: 0.8; }
            50% { transform: translate(8px, 12px) rotate(10deg); opacity: 0.6; }
            100% { transform: translate(0, -0px) rotate(0deg); opacity: 0.8; }
        }

        .explore-section {
            padding: 4rem 0;
        }
        .place-card {
            position: relative;
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
            height: 250px;
        }
        .place-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        .place-card:hover {
             transform: translateY(-5px) scale(1.03);
        }
        .place-card:hover img {
            transform: scale(1.1);
        }
        .place-card-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.85), transparent);
            color: white;
            padding: 1.5rem 1rem 1rem;
            text-align: left;
        }
        .place-card-overlay h5 {
            margin: 0;
            font-weight: bold;
        }

    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark navbar-glass fixed-top">
        <div class="container">
            <a class="navbar-brand fw-bold" href="#">
                <i class="bi bi-shield-check"></i>
                Tourist Safety
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link active" aria-current="page" href="#">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">About</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">Contact</a></li>
                </ul>
            </div>
        </div>
    </nav>


    <main class="container p-3">
        <!-- Auth Card -->
        <div class="card auth-card shadow-lg border-0 mx-auto">
            <!-- Floating Travel Doodle SVGs -->
            <div class="doodle doodle-1"> <!-- Airplane -->
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M22.82,12.44,14,1.35A2,2,0,0,0,12.53.5h0a2,2,0,0,0-1.41.59L2.3,9.91a1.23,1.23,0,0,0-.3.92V11a1,1,0,0,0,1,1H14.24l2.12,2.12a2,2,0,0,0,2.83,0l3.05-3.05a2,2,0,0,0,.58-2.65ZM9.44,11.21,4,13.33V11.7l5.44-2.12,2.44,2.44Zm7.1-1.55L14.1,7.21l1.5-1.5,2.44,2.44Z"/><path d="M12.53,22.5a2,2,0,0,0,1.41-.59l8.82-8.82a1,1,0,0,0-1.41-1.41l-8.4,8.39-4.82-1.93-1.41,1.41,4.71,4.71A2,2,0,0,0,12.53,22.5Z"/></svg>
            </div>
            <div class="doodle doodle-2"> <!-- Camera -->
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19.71,6.29,18,4.58V4a2,2,0,0,0-2-2H8A2,2,0,0,0,6,4v.58L4.29,6.29A1,1,0,0,0,4,7v13a2,2,0,0,0,2,2H18a2,2,0,0,0,2-2V7A1,1,0,0,0,19.71,6.29ZM8,4h8V6H8ZM18,20H6V8H18Zm-6-9a4,4,0,1,0,4,4A4,4,0,0,0,12,11Zm0,6a2,2,0,1,1,2-2A2,2,0,0,1,12,17Z"/></svg>
            </div>
             <div class="doodle doodle-3"> <!-- Compass -->
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12,2A10,10,0,1,0,22,12,10,10,0,0,0,12,2Zm0,18a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z"/><path d="M14.21,8.38,12,12l-2.21-3.62a1,1,0,0,1,1-1.55l3.45,2.07A1,1,0,0,1,14.21,8.38Z"/><path d="M9.79,15.62,12,12l2.21,3.62a1,1,0,0,1-1,1.55L9.75,15.07A1,1,0,0,1,9.79,15.62Z"/></svg>
            </div>
             <div class="doodle doodle-4"> <!-- Map Pin -->
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12,2a8,8,0,0,0-8,8c0,5.4,7,11.5,7.35,11.8a1,1,0,0,0,1.3,0C13,21.5,20,15.4,20,10A8,8,0,0,0,12,2Zm0,11a3,3,0,1,1,3-3A3,3,0,0,1,12,13Z"/></svg>
            </div>
            <div class="doodle doodle-5"> <!-- Suitcase -->
                 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18,6H16V5a3,3,0,0,0-3-3H11A3,3,0,0,0,8,5V6H6A3,3,0,0,0,3,9V19a3,3,0,0,0,3,3H18a3,3,0,0,0,3-3V9A3,3,0,0,0,18,6ZM10,5a1,1,0,0,1,1-1h2a1,1,0,0,1,1,1V6H10ZM19,19a1,1,0,0,1-1,1H6a1,1,0,0,1-1-1V9A1,1,0,0,1,6,8H18a1,1,0,0,1,1,1Z"/></svg>
            </div>
            <div class="doodle doodle-6"> <!-- Passport -->
                 <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M19,2H9A3,3,0,0,0,6,5V19a3,3,0,0,0,3,3H19a3,3,0,0,0,3-3V5A3,3,0,0,0,19,2Zm-1,2a1,1,0,1,1-1,1A1,1,0,0,1,18,4ZM12,6a1,1,0,1,1-1,1A1,1,0,0,1,12,6Zm0,12a5,5,0,1,1,5-5A5,5,0,0,1,12,18Zm0-8a3,3,0,1,0,3,3A3,3,0,0,0,12,10Zm7,8H9a1,1,0,0,1,0-2H19a1,1,0,0,1,0,2Zm0-12H9A1,1,0,0,1,9,4H15a1,1,0,0,1,0,2Z"/><path d="M5,20a1,1,0,0,0,1-1V5A1,1,0,0,0,4,5V19A1,1,0,0,0,5,20Z"/></svg>
            </div>


            <div class="card-header bg-transparent border-0 text-center pt-5 header-image-container">
                <img src="{% static 'hawa_mahal.jpg' %}" class="namaste-img" alt="Hawa Mahal">
                <span class="welcome-text">Welcome</span>
            </div>

            <div class="card-body p-4 p-md-5" id="auth-container">
                <div class="text-center mb-4">
                    <div>
                        <h1 id="formTitle" class="h2 brand-font">Namaste India</h1>
                    </div>
                    <p id="welcomeMessage" class="text-muted mt-2">Welcome! Please sign in to continue.</p>
                </div>
                 <!-- API Message Area -->
                <div id="apiMessage" class="alert d-none" role="alert"></div>

                <!-- Login Form -->
                <form id="loginForm">
                    <div class="mb-3">
                        <label for="loginEmail" class="form-label">Email address</label>
                        <input type="email" class="form-control" id="loginEmail" required>
                    </div>
                    <div class="mb-3">
                        <label for="loginPassword" class="form-label">Password</label>
                        <input type="password" class="form-control" id="loginPassword" required>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-hover-effect">Login</button>
                    </div>
                </form>

                <!-- Signup Form -->
                <form id="signupForm" class="d-none">
                    <div class="mb-3">
                        <label for="signupUsername" class="form-label">Username</label>
                        <input type="text" class="form-control" id="signupUsername" required>
                    </div>
                    <div class="mb-3">
                        <label for="signupEmail" class="form-label">Email address</label>
                        <input type="email" class="form-control" id="signupEmail" required>
                    </div>
                    <div class="mb-3">
                        <label for="signupPhone" class="form-label">Phone Number</label>
                        <input type="tel" class="form-control" id="signupPhone" required>
                    </div>
                    <div class="mb-3">
                        <label for="signupPassport" class="form-label">Passport / Aadhaar No.</label>
                        <input type="text" class="form-control" id="signupPassport" required>
                    </div>
                    <div class="mb-3">
                        <label for="signupPassword" class="form-label">Password</label>
                        <input type="password" class="form-control" id="signupPassword" required>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-hover-effect">Create Account</button>
                    </div>
                </form>
                
                <!-- Other Forms (OTP, Success) remain unchanged -->
                 <form id="emailOtpForm" class="d-none">
                    <div class="mb-3 text-center">
                        <label for="emailOtp" class="form-label">Enter Email OTP</label>
                        <input type="text" class="form-control text-center" id="emailOtp" maxlength="6" required>
                        <div class="form-text">A 6-digit code was sent to your email.</div>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-hover-effect">Verify Email</button>
                    </div>
                </form>
                <form id="phoneOtpForm" class="d-none">
                    <div class="mb-3 text-center">
                        <label for="phoneOtp" class="form-label">Enter Phone OTP</label>
                        <input type="text" class="form-control text-center" id="phoneOtp" maxlength="6" required>
                        <div class="form-text">A 6-digit code was sent to your phone.</div>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary btn-hover-effect">Verify Phone & Finish</button>
                    </div>
                </form>
                <div id="successView" class="d-none text-center">
                    <h3 class="text-success">Registration Complete!</h3>
                    <p>Redirecting you to the dashboard...</p>
                </div>
                
                <div class="text-center mt-3">
                     <button type="button" class="btn btn-outline-primary btn-sm btn-hover-effect" id="getTipBtn">
                         ✨ Get a Travel Tip!
                     </button>
                </div>

                <div id="toggleContainer" class="text-center mt-4">
                    <p id="toggleText" class="mb-0">
                        Don't have an account? 
                        <a href="#" id="showSignup" class="fw-bold">Sign Up</a>
                    </p>
                </div>
            </div>
        </div>
    </main>

    <!-- Key Features Section -->
    <section class="features-section">
        <div class="container text-center">
            <h2 class="mb-5 brand-font" style="font-size: 2.5rem;">A New Standard in Tourist Safety</h2>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="feature-card h-100">
                        <i class="bi bi-shield-lock-fill feature-icon mb-3"></i>
                        <h5>Blockchain Digital ID</h5>
                        <p class="text-white-50">Secure, tamper-proof identity verification valid only for your trip duration, ensuring privacy and security.</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-card h-100">
                        <i class="bi bi-robot feature-icon mb-3"></i>
                        <h5>AI Anomaly Detection</h5>
                        <p class="text-white-50">Our system intelligently monitors for unusual activity and alerts authorities if you deviate from your path or go silent.</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-card h-100">
                        <i class="bi bi-exclamation-triangle-fill feature-icon mb-3"></i>
                        <h5>Instant SOS & Alerts</h5>
                        <p class="text-white-50">A panic button shares your live location with the nearest police unit, while geo-fencing warns you of high-risk zones.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Explore Incredible India Section -->
    <section class="explore-section py-5">
        <div class="container text-center">
             <h2 class="mb-5 brand-font" style="font-size: 2.5rem;">Explore Incredible India</h2>
             <div class="row g-4">
                <div class="col-md-4">
                    <div class="place-card">
                        <img src="https://res.cloudinary.com/dve59du8z/image/upload/v1757751734/images_l4sppx.jpg" class="img-fluid" alt="Ellora Caves">
                        <div class="place-card-overlay">
                            <h5>Ellora Caves</h5>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                     <div class="place-card">
                        <img src="https://res.cloudinary.com/dve59du8z/image/upload/v1757751870/Wallpaper_900x_qf2dln.webp" class="img-fluid" alt="Varanasi Ghats">
                         <div class="place-card-overlay">
                            <h5>Ghats of Varanasi</h5>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                     <div class="place-card">
                        <img src="https://res.cloudinary.com/dve59du8z/image/upload/v1757751913/abcd_zimzt0.jpg" class="img-fluid" alt="Kerala Backwaters">
                         <div class="place-card-overlay">
                            <h5>Kerala Backwaters</h5>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-4 mb-md-0 text-center text-md-start">
                    <h5><i class="bi bi-shield-check"></i> Tourist Safety System</h5>
                    <p class="text-white-50 small">Ensuring every journey through the incredible landscapes of India is safe, secure, and memorable. Your safety is our technology's purpose.</p>
                </div>
                <div class="col-md-2 col-6 mb-4 mb-md-0">
                    <h5>Quick Links</h5>
                    <ul class="list-unstyled">
                        <li><a href="#">Home</a></li>
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Features</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                </div>
                <div class="col-md-3 col-6 mb-4 mb-md-0">
                    <h5>Legal</h5>
                    <ul class="list-unstyled">
                        <li><a href="#">Privacy Policy</a></li>
                        <li><a href="#">Terms of Service</a></li>
                        <li><a href="#">Data Protection</a></li>
                    </ul>
                </div>
                <div class="col-md-3 text-center text-md-end">
                    <h5>Connect With Us</h5>
                    <div class="social-icons">
                        <a href="#"><i class="bi bi-twitter-x"></i></a>
                        <a href="#"><i class="bi bi-facebook"></i></a>
                        <a href="#"><i class="bi bi-instagram"></i></a>
                    </div>
                </div>
            </div>
            <hr class="my-4" style="border-color: rgba(255,255,255,0.2);">
            <div class="text-center text-white-50 small">
                <p>&copy; 2025 Smart Tourist Safety Monitoring & Incident Response System. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Modals and Scripts remain unchanged -->
     <div class="modal fade" id="tipModal" tabindex="-1" aria-labelledby="tipModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header border-0">
            <h5 class="modal-title" id="tipModalLabel">✨ Your AI Travel Tip!</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" id="tipModalBody"></div>
          <div class="modal-footer border-0">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // All JavaScript logic remains the same
        document.addEventListener('DOMContentLoaded', () => {
            const views = {
                login: document.getElementById('loginForm'),
                signup: document.getElementById('signupForm'),
                emailOtp: document.getElementById('emailOtpForm'),
                phoneOtp: document.getElementById('phoneOtpForm'),
                success: document.getElementById('successView')
            };

            const formTitle = document.getElementById('formTitle');
            const welcomeMessage = document.getElementById('welcomeMessage');
            const toggleText = document.getElementById('toggleText');
            const toggleContainer = document.getElementById('toggleContainer');
            const getTipBtn = document.getElementById('getTipBtn');
            const apiMessage = document.getElementById('apiMessage');
            const tipModalEl = document.getElementById('tipModal');
            const tipModal = new bootstrap.Modal(tipModalEl);
            const tipModalBody = document.getElementById('tipModalBody');

            let userEmail = '';
            let userPhone = '';
            
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
            const csrftoken = getCookie('csrftoken');

            const showView = (viewName) => {
                hideApiMessage();
                Object.values(views).forEach(view => view.classList.add('d-none'));
                views[viewName].classList.remove('d-none');
                updateTitles(viewName);
            };

            const showApiMessage = (message, isError = true) => {
                let finalMessage = message;
                if (Array.isArray(message)) {
                    finalMessage = message.join('<br>');
                }
                apiMessage.innerHTML = finalMessage;
                apiMessage.classList.remove('d-none', 'alert-success', 'alert-danger');
                apiMessage.classList.add(isError ? 'alert-danger' : 'alert-success');
            };

            const hideApiMessage = () => {
                apiMessage.classList.add('d-none');
            };

            const updateTitles = (viewName) => {
                toggleContainer.classList.remove('d-none');
                getTipBtn.classList.remove('d-none');

                switch(viewName) {
                    case 'signup':
                        formTitle.innerHTML = 'Namaste India';
                        welcomeMessage.textContent = 'Create an account to get started.';
                        toggleText.innerHTML = `Already have an account? <a href="#" id="showLogin" class="fw-bold">Login</a>`;
                        document.getElementById('showLogin').addEventListener('click', (e) => { e.preventDefault(); showView('login'); });
                        break;
                    case 'emailOtp':
                        formTitle.textContent = "Verify Your Email";
                        welcomeMessage.textContent = `Enter the code sent to ${userEmail}`;
                        toggleContainer.classList.add('d-none');
                        getTipBtn.classList.add('d-none');
                        break;
                    case 'phoneOtp':
                        formTitle.textContent = "Verify Your Phone";
                        welcomeMessage.textContent = `Last step! Enter the code sent to ${userPhone}`;
                        toggleContainer.classList.add('d-none');
                        getTipBtn.classList.add('d-none');
                        break;
                    case 'success':
                        formTitle.textContent = "Welcome!";
                        welcomeMessage.textContent = `You are ready to explore safely.`;
                        toggleContainer.classList.add('d-none');
                        getTipBtn.classList.add('d-none');
                        break;
                    default: // login
                        formTitle.innerHTML = 'Namaste India';
                        welcomeMessage.textContent = 'Welcome! Please sign in to continue.';
                        toggleText.innerHTML = `Don't have an account? <a href="#" id="showSignup" class="fw-bold">Sign Up</a>`;
                        document.getElementById('showSignup').addEventListener('click', (e) => { e.preventDefault(); showView('signup'); });
                        break;
                }
            };
            
            document.getElementById('showSignup').addEventListener('click', (e) => { e.preventDefault(); showView('signup'); });

            views.signup.addEventListener('submit', async (e) => {
                e.preventDefault();
                hideApiMessage();
                const formData = {
                    username: document.getElementById('signupUsername').value,
                    email: document.getElementById('signupEmail').value,
                    phone: document.getElementById('signupPhone').value,
                    passport_aadhaar: document.getElementById('signupPassport').value,
                    password: document.getElementById('signupPassword').value,
                };
                userEmail = formData.email;
                userPhone = formData.phone;

                try {
                    const response = await fetch('/api/v1/auth/register/', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': csrftoken
                        },
                        body: JSON.stringify(formData)
                    });
                    const data = await response.json();
                    if (response.ok) {
                        showApiMessage(data.message, false);
                        showView('emailOtp');
                    } else {
                        showApiMessage(data.errors || 'An unknown error occurred.');
                    }
                } catch (error) {
                    showApiMessage('Could not connect to the server.');
                }
            });

            views.emailOtp.addEventListener('submit', async(e) => {
                e.preventDefault();
                hideApiMessage();
                const formData = {
                    email: userEmail,
                    otp: document.getElementById('emailOtp').value
                };
                try {
                    const response = await fetch('/api/v1/auth/verify-email/', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrftoken },
                        body: JSON.stringify(formData)
                    });
                    const data = await response.json();
                    if (response.ok) {
                        showApiMessage(data.message, false);
                        showView('phoneOtp');
                    } else {
                        showApiMessage(data.error || 'An unknown error occurred.');
                    }
                } catch (error) {
                    showApiMessage('Could not connect to the server.');
                }
            });

            views.phoneOtp.addEventListener('submit', async(e) => {
                e.preventDefault();
                hideApiMessage();
                const formData = {
                    phone: userPhone,
                    otp: document.getElementById('phoneOtp').value
                };
                try {
                    const response = await fetch('/api/v1/auth/verify-phone/', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrftoken },
                        body: JSON.stringify(formData)
                    });
                    const data = await response.json();
                    if (response.ok) {
                        localStorage.setItem('authToken', data.token);
                        showApiMessage(data.message, false);
                        showView('success');
                        setTimeout(() => { window.location.href = '/dashboard'; }, 2000);
                    } else {
                        showApiMessage(data.error || 'An unknown error occurred.');
                    }
                } catch (error) {
                    showApiMessage('Could not connect to the server.');
                }
            });

            views.login.addEventListener('submit', async(e) => {
                e.preventDefault();
                hideApiMessage();
                const formData = {
                    email: document.getElementById('loginEmail').value,
                    password: document.getElementById('loginPassword').value
                };
                try {
                    const response = await fetch('/api/v1/auth/login/', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrftoken },
                        body: JSON.stringify(formData)
                    });
                    const data = await response.json();
                    if (response.ok) {
                        localStorage.setItem('authToken', data.token);
                        showApiMessage(data.message, false);
                        setTimeout(() => { window.location.href = '/dashboard'; }, 1500);
                    } else {
                        showApiMessage(data.error || 'An unknown error occurred.');
                    }
                } catch (error) {
                    showApiMessage('Could not connect to the server.');
                }
            });

            // Gemini API Feature
            const getTravelTip = async () => {
                tipModalBody.innerHTML = `<div class="d-flex justify-content-center"><div class="spinner-border text-warning" role="status"><span class="visually-hidden">Loading...</span></div></div><p class="text-center mt-2 text-muted">Generating your tip...</p>`;
                tipModal.show();
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                const userPrompt = "Generate a single, fun, and surprising travel tip about India. Keep it to one short sentence.";
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: userPrompt }] }] })
                    });
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const result = await response.json();
                    const tipText = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    if (tipText) {
                        tipModalBody.innerHTML = `<p class="lead text-center">${tipText}</p>`;
                    } else {
                        throw new Error("Could not extract tip from API response.");
                    }
                } catch (error) {
                    console.error("Error fetching travel tip:", error);
                    tipModalBody.innerHTML = `<p class="text-danger text-center">Sorry, couldn't fetch a tip right now. Please try again later!</p>`;
                }
            };
            getTipBtn.addEventListener('click', getTravelTip);

            showView('login');
        });
    </script>
</body>
</html>
